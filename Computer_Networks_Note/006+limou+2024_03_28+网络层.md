网络层我们只提及 `IP` 协议。

![image-20240406172348384](./assets/image-20240406172348384.png)

主机可以配有 `IP` 地址，路由器可以被称为主机，但是不仅具有 `IP`，又可以进行路由控制。

节点就是主机和路由器的统称。

# IP 协议格式

![image-20240406221911241](./assets/image-20240406221911241.png)

数据就是 `tcp` 的数据段，如何封装和解包的问题和之前的差不多。前 `20` 个字节也是固定的，`4` 位首部长度，减去 `20` 字节就是选项字节（定长报头+自描述）。

`8` 位协议可以用来标识 `UDP` 或者 `TCP`，用来辅助向上交付。

`4` 位版本填写的就是 `ipv4`（这是什么东西？和 `ipv6` 有什么区别？`ipv4` 就是用 `4` 字节来表示 `ip` 地址）。

IPv4是互联网上最常用的协议，它使用32位地址来唯一标识网络上的设备。IPv4地址通常用点分十进制表示，如192.168.1.1，每个部分取值范围是0到255。由于IPv4地址空间有限，约42亿个地址，随着互联网的发展，IPv4地址资源已经耗尽（但是“如耗”），并且面临着地址短缺的问题。

IPv6是IPv4的后继版本，旨在解决IPv4的地址耗尽问题。它采用128位地址，比IPv4的地址空间大得多。IPv6地址通常使用冒号十六进制表示法，如2001:0db8:85a3:0000:0000:8a2e:0370:7334。IPv6地址空间极大，约为3.4 × 10^38个地址，足够满足未来的互联网需求。IPv6还提供了一些其他功能，如改进的安全性和配置选项。

>   吐槽：底层技术的发展比较稳定，`ipv4` 和 `ipv6` 不兼容。

首部长度用 `4` 个比特位表示会不会有点少？其实不会，首部长度的基本单位是 `4` 字节，刚好就是整个报文的宽度，因此最低填 `20/4` 最高填 `60/4`。

`8` 位的服务类型：

![image-20240406231839294](./assets/image-20240406231839294.png)

保留位做保留，暂不使用。

`10` 位总长度包含整个 `IP` 报文，因此 `有效载荷=16位总长度-4位首部长度*4`。

`8` 位生存时间（`TTL`），为了防止网络中环路、黑洞的存在，因此就需要设置生存时间，让其消散。没经过一个节点就会做 `--`，就会被视为丢弃。

`16` 位首部校验和如果没有通过就会被丢弃。

接下来的两个 `IP` 就比较简单理解了，`IP` 就是用在网络层、`port` 就用在传输层。

另外我们会发现，`TCP` 报头和 `IP` 报头

`16` 标识和 `3` 位标识，`13` 位片偏移呢？和下层链路层有关。由于物理特性的原因，一般无法转发太长太大的数据，这个上限大小一般是 `1500/MTU(最大传输单元)`。

如果网络层向下交付了 `2500` 字节的数据，因此就需要对数据做数据分片分别发送。

分片和组装的工作应该交给 `IP` 协议，不应该交给数据链路层（只有网络层才知道这么进行更好的分片，就行快递分包不应该交给快递公司来决定）。

