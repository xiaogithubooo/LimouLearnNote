# 4.环境变量与相关命令

4.1.环境变量概念
----------

首先要知道一个事实：`Linux`里面使用的指令也是经过代码编写产生的可执行文件，在`Linux`下的任何文件路径都可以使用这些指令，那能不能让我们自己编写的代码也这样呢？答案是可以，不过需要使用环境变量。

在编写`C/C++`代码的链接的时候，我们是不知道链接的动态静态库在哪里的，都是照样可以链接成功，生成可执行程序，原因也是有相关环境变量帮助编译器进行查看。

环境变量是指在操作系统中用来指定操作系统运行环境的一些参数，环境变量通常具有某些特殊用途，还有在系统中通常具有全局特性。  

## 4.2.常见环境变量

1. `PATH`：指定命令的搜索路径

2. `HOME`：指定用户的主工作目录（指令`cd ~`就是根据`HOME`变量来进行确认的）

3. `SHELL`：当前`Shell`，其值通常为`/bin/bash`。

4. `HISTSIZE`：其值为设置shell历史记录大小的变量（使用`history`指令可以查看`HISTSIZE`条历史指令）

5. `LS_COLORS`：环境变量是用于设置`ls`命令在终端中显示不同文件类型和属性时的颜色的变量。通过指定不同文件类型和属性对应的颜色码，可以使文件在终端中以不同的颜色进行区分和显示

6. `LOGNAME`：记录登录的用户名

`Linux`中的环境变量有很多，基本都是独立工作的，各有各的功能。  

## 4.3.查看环境变量的方法

使用命令`echo $NAME`即可查看对应变量的情况，如果不带`$`符号就直接打印出来了。

<img src="D:/GitWork/limou-learn-note/LinuxNote/assets/a9acd192-f98e-49e8-ab3a-e84b6d405aa2.png" title="" alt="a9acd192-f98e-49e8-ab3a-e84b6d405aa2" style="zoom:50%;">

在`Windows`操作系统里也是可以有相关的环境变量操作的。

还可以使用命令`env`来查看当前系统的所有环境变量（`set`命令则是显示本地定义的`shell`变量和环境变量）：

<img src="D:/GitWork/limou-learn-note/LinuxNote/assets/a96cf9d3-455a-41a8-9691-80553df8230d.png" title="" alt="a96cf9d3-455a-41a8-9691-80553df8230d" style="zoom:50%;">

一般情况下，在`Linux`命令行中修改环境变量只适用于本次会话（本次登录），一旦退出登录就无效了，不过如果修改的是保存环境变量的文件就有可能造成较大的影响.

## 4.5.修改PATH环境变量

如果我们想要实现我们自己编写的可执行程序和`Linux`内置指令一样的使用效果，有两种方法，一是吧您自己写的可执行程序放进`PATH`环境变量中的文件路径下，这样就可以像使用`Linux`指令一样使用自己编写的可执行程序（一般放在`/usr/bin`下比较多，这种行为叫做“给系统安装程序”，但是这种做法不建议，有可能污染操作系统）。

还有一种方法是使用配置`PATH`环境变量，这样操作不会污染到系统的文件。

<img src="D:/GitWork/limou-learn-note/LinuxNote/assets/66d770f4-f9c0-49ed-8540-603460ae0fad.png" title="" alt="66d770f4-f9c0-49ed-8540-603460ae0fad" style="zoom:67%;">

如果使用命令`unset 某环境变量`可以清除某个环境变量，使用后就会发现连其他的`Linux`指令都无法使用了，不过不用担心，下次登录还是会恢复默认的`PATH`值的。

# 4.6.环境变量的组织形式

每个程序都会收到一张环境表，环境表是一个字符指针数组，每个指针指向一个以`\0`结尾的环境字符串（下面是简化版），并且最后一个元素指向`NULL`。

<img src="D:/GitWork/limou-learn-note/LinuxNote/assets/748ac43e-acdd-44e9-8c05-38294b556eb6.png" title="" alt="748ac43e-acdd-44e9-8c05-38294b556eb6" style="zoom:50%;">

## 4.7.通过代码获取环境变量

实际上`main`函数可以带上三个参数，第三参数实际上就是有关环境变量的参数：

```c
int mian(int argc, char * argv[], char * env[])
{}
```

这里的`env`数组也就对应上面的`char*`类型数组。

因此我们可以尝试使用这个这个参数来编写相关环境变量的代码。

<img src="D:/GitWork/limou-learn-note/LinuxNote/assets/944974e3-c149-43f6-adcb-ef70fc365998.png" title="" alt="944974e3-c149-43f6-adcb-ef70fc365998" style="zoom:50%;">

<img src="D:/GitWork/limou-learn-note/LinuxNote/assets/cd5ceb1d-1963-46ef-986b-18e6cac3d31e.png" title="" alt="cd5ceb1d-1963-46ef-986b-18e6cac3d31e" style="zoom:50%;">

除了这种方法还可以使用`unistd.h`内定义的`environ`全局变量来获取环境变量的值。

<img src="D:/GitWork/limou-learn-note/LinuxNote/assets/23d3560c-b017-49dc-9865-684b9ce93e3f.png" title="" alt="23d3560c-b017-49dc-9865-684b9ce93e3f" style="zoom:50%;">

但是前两种方法我们都不怎么使用，最常用的是使用`stdlib.h`的`getenv()`函数，根据参数来获取对应的环境变量值（其参数是想获取环境变量的变量名字）。

> 一般`main`函数的环境变量参数是又父进程继承过来的，父进程也是从它自己的父进程获取的，最终在`bash`进程获取，而所有进程的父进程是当前`bash`。这也是环境变量之所以具有全局属性的本质原因，而`env[]`参数也是依靠父进程传参的。这一点您可以在`bash`下自己创建一个环境变量，然后使用C语言库内的`getenv()`函数读取环境变量。

实际上对应环境变量这样的“全局变量”，还有一个“局部变量”，即：`shell`变量，就是直接在`bash`定义一个变量，这个变量可以使用`set`命令查看，没有办法在C代码中使用`getenv()`获取。

shell变量实际上最常用的场景是在`shell`脚本里，这个`shell`脚本我们以后再提及。

<img src="D:/GitWork/limou-learn-note/LinuxNote/assets/775f92dc-0230-44df-8798-dd071dbc49ff.png" title="" alt="775f92dc-0230-44df-8798-dd071dbc49ff" style="zoom:50%;">

<img src="D:/GitWork/limou-learn-note/LinuxNote/assets/58589ff3-ebd6-4ce2-a5c6-9a9a427efde2.png" title="" alt="58589ff3-ebd6-4ce2-a5c6-9a9a427efde2" style="zoom:50%;">

上面没有办法获取`shell`变量的。

> 另外这里顺便科普一下命令行参数`argc`和`argv[]`，前者获取的是命令字符串的个数，后者是存储命令字符串的char*指针数组，由启动程序的命令字符来负责传递参数给这两个变量。这两个参数就给我们一种可能：制作带有选项的自定义Linux命令的可能性，再结合环境变量，完全可以做出“原滋原味”的Linux指令（这实际上也是Linux内置指令的实现方式）。 

#